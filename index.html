<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Hand Schematic – Right Hand (Dorsal)</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  background:#000;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}
svg{width:360px;height:360px;}

.palm{
  fill: rgba(255,255,0,0.25); /* ★半透明：ペン遮蔽 */
  stroke: yellow;
  stroke-width:6;
}

.finger,.thumb,.wrist{
  stroke: yellow;
  stroke-linecap: round;
  stroke-width:5;
}

.nail{ fill: yellow; }

.pen{
  stroke:#00ff66;
  stroke-width:5;
  stroke-linecap:round;
  opacity:0;
}

.label{
  fill:#aaa;
  font-size:12px;
  text-anchor:middle;
}
</style>
</head>

<body>
<svg viewBox="0 0 360 360">

  <!-- ペン（★下レイヤー） -->
  <line id="pen" class="pen"/>

  <!-- 手首（右手・背側） -->
  <line x1="165" y1="300" x2="165" y2="260" class="wrist"/>
  <line x1="195" y1="300" x2="195" y2="260" class="wrist"/>

  <!-- 手の甲 -->
  <rect x="120" y="200" width="120" height="60" rx="20" class="palm"/>

  <!-- 指（右手・背側：親指が右） -->
  <line id="little" class="finger"/>
  <line id="ring"   class="finger"/>
  <line id="middle" class="finger"/>
  <line id="index"  class="finger"/>
  <line id="thumb"  class="thumb"/>

  <!-- 爪（全指） -->
  <polygon id="n_little" class="nail"/>
  <polygon id="n_ring"   class="nail"/>
  <polygon id="n_middle" class="nail"/>
  <polygon id="n_index"  class="nail"/>
  <polygon id="n_thumb"  class="nail"/>

  <text id="stateLabel" x="180" y="40" class="label">OPEN</text>
</svg>

<script>
const baseY=200;

// 右手・背側配置
const fingers={
  little:{ x:135, open:60, pen:18 },
  ring:{   x:155, open:70, pen:28 },
  middle:{ x:175, open:75, pen:40 },
  index:{  x:195, open:75, pen:58 }
};

// 親指（右側・内転）
const thumb={
  x1:240,y1:235,
  open:{ x2:270,y2:200 },
  pen:{  x2:210,y2:215 }
};

let t=0,target=0;
const speed=0.08;
const lerp=(a,b,t)=>a+(b-a)*t;

function nail(id,x,y){
  const s=6;
  document.getElementById(id)
    .setAttribute("points",`${x-s},${y} ${x+s},${y} ${x},${y-s}`);
}

function animate(){
  t+=(target-t)*speed;

  for(const id in fingers){
    const f=fingers[id];
    const len=lerp(f.open,f.pen,t);
    const x=f.x,y2=baseY-len;
    const el=document.getElementById(id);
    el.setAttribute("x1",x);
    el.setAttribute("y1",baseY);
    el.setAttribute("x2",x);
    el.setAttribute("y2",y2);

    const n=document.getElementById("n_"+id);
    if(t<0.05){ nail("n_"+id,x,y2); n.style.opacity=1; }
    else n.style.opacity=0;
  }

  // 親指
  const tx=lerp(thumb.open.x2,thumb.pen.x2,t);
  const ty=lerp(thumb.open.y2,thumb.pen.y2,t);
  const th=document.getElementById("thumb");
  th.setAttribute("x1",thumb.x1);
  th.setAttribute("y1",thumb.y1);
  th.setAttribute("x2",tx);
  th.setAttribute("y2",ty);

  const nt=document.getElementById("n_thumb");
  if(t<0.05){ nail("n_thumb",tx,ty); nt.style.opacity=1; }
  else nt.style.opacity=0;

  // ペン（先端が親指寄り・より垂直）
  const pen=document.getElementById("pen");
  if(t>0.95){
    pen.style.opacity=1;
    pen.setAttribute("x1",220);
    pen.setAttribute("y1",160);
    pen.setAttribute("x2",200);
    pen.setAttribute("y2",210);
  }else pen.style.opacity=0;

  requestAnimationFrame(animate);
}

setInterval(()=>{
  target=target===0?1:0;
  document.getElementById("stateLabel").textContent=
    target===0?"OPEN":"PEN HOLD";
},3000);

animate();
</script>
</body>
</html>
